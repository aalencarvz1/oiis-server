<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Autenticação - AuthController</title>
</head>
<body>
  <main>
    <h1>Autenticação - AuthController</h1>
    <p>
      O <code>AuthController</code> gerencia autenticação de usuários via JWT (JSON Web Tokens) e autenticação básica. Inclui endpoints para login, registro, renovação de tokens, recuperação de senha, e middlewares para verificação de tokens.
    </p>

    <section id="authcontroller-login">
      <h2>login (RequestHandler)</h2>
      <p>
        Autentica um usuário e retorna um token de acesso e um refresh token.
      </p>
      <h3>Detalhes do Endpoint</h3>
      <ul>
        <li><strong>Método</strong>: POST</li>
        <li><strong>URL</strong>: <code>/api/controllers/auth/authcontroller/login</code></li>
      </ul>
      <h3>Parâmetros</h3>
      <ul>
        <li><code>email</code> (obrigatório, body): Email do usuário.</li>
        <li><code>password</code> (obrigatório, body): Senha do usuário.</li>
        <li><code>currentTimeZoneOffset</code> (opcional, body): Offset do fuso horário.</li>
      </ul>
      <h3>Exemplo de Requisição</h3>
      <pre><code>
POST /api/controllers/auth/authcontroller/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "senha123",
  "currentTimeZoneOffset": 0
}
      </code></pre>
      <h3>Resposta</h3>
      <p><strong>Status</strong>: 200</p>
      <pre><code>
{
  "success": true,
  "message": "logged",
  "data": {
    "token": "jwt_token",
    "refreshToken": "refresh_token",
    "user": {
      "id": 1,
      "email": "user@example.com",
      "access_profile_id": 1,
      "last_token": "jwt_token",
      "last_timezone_offset": 0
    }
  },
  "exception": null
}
      </code></pre>
      <p><strong>Status</strong>: 401 (erro)</p>
      <pre><code>
{
  "success": false,
  "message": "user not found",
  "data": null,
  "exception": null
}
      </code></pre>
      <a href="#top" class="button">Voltar ao topo</a>
    </section>

    <section id="authcontroller-register">
      <h2>register (RequestHandler)</h2>
      <p>
        Registra um novo usuário.
      </p>
      <h3>Detalhes do Endpoint</h3>
      <ul>
        <li><strong>Método</strong>: POST</li>
        <li><strong>URL</strong>: <code>/api/controllers/auth/authcontroller/register</code></li>
      </ul>
      <h3>Parâmetros</h3>
      <ul>
        <li><code>email</code> (obrigatório, body): Email do usuário.</li>
        <li><code>password</code> (obrigatório, body): Senha (mínimo 8 caracteres).</li>
        <li><code>currentTimeZoneOffset</code> (opcional, body): Offset do fuso horário.</li>
      </ul>
      <h3>Exemplo de Requisição</h3>
      <pre><code>
POST /api/controllers/auth/authcontroller/register
Content-Type: application/json

{
  "email": "newuser@example.com",
  "password": "senha12345",
  "currentTimeZoneOffset": 0
}
      </code></pre>
      <h3>Resposta</h3>
      <p><strong>Status</strong>: 200</p>
      <pre><code>
{
  "success": true,
  "message": "logged",
  "data": {
    "token": "jwt_token",
    "user": {
      "id": 2,
      "email": "newuser@example.com",
      "access_profile_id": 1,
      "last_token": "jwt_token",
      "last_timezone_offset": 0
    }
  },
  "exception": null
}
      </code></pre>
      <p><strong>Status</strong>: 401 (erro)</p>
      <pre><code>
{
  "success": false,
  "message": "user already register",
  "data": null,
  "exception": null
}
      </code></pre>
      <a href="#top" class="button">Voltar ao topo</a>
    </section>

    <section id="authcontroller-refresh_token">
      <h2>refresh_token (RequestHandler)</h2>
      <p>
        Renova o token de acesso usando o refresh token.
      </p>
      <h3>Detalhes do Endpoint</h3>
      <ul>
        <li><strong>Método</strong>: POST</li>
        <li><strong>URL</strong>: <code>/api/controllers/auth/authcontroller/refresh_token</code></li>
      </ul>
      <h3>Parâmetros</h3>
      <ul>
        <li><code>refreshToken</code> (obrigatório, body ou cookie): Refresh token.</li>
        <li><code>currentTimeZoneOffset</code> (opcional, body): Offset do fuso horário.</li>
      </ul>
      <h3>Exemplo de Requisição</h3>
      <pre><code>
POST /api/controllers/auth/authcontroller/refresh_token
Content-Type: application/json

{
  "refreshToken": "refresh_token",
  "currentTimeZoneOffset": 0
}
      </code></pre>
      <h3>Resposta</h3>
      <p><strong>Status</strong>: 200</p>
      <pre><code>
{
  "success": true,
  "message": "logged",
  "data": {
    "token": "new_jwt_token",
    "refreshToken": "new_refresh_token",
    "user": {
      "id": 1,
      "email": "user@example.com",
      "access_profile_id": 1,
      "last_token": "new_jwt_token",
      "last_timezone_offset": 0
    }
  },
  "exception": null
}
      </code></pre>
      <p><strong>Status</strong>: 401 (erro)</p>
      <pre><code>
{
  "success": false,
  "message": "no refresh token",
  "data": null,
  "exception": null
}
      </code></pre>
      <a href="#top" class="button">Voltar ao topo</a>
    </section>

    <section id="authcontroller-send_email_recover_password">
      <h2>send_email_recover_password (RequestHandler)</h2>
      <p>
        Envia um email com link para recuperação de senha.
      </p>
      <h3>Detalhes do Endpoint</h3>
      <ul>
        <li><strong>Método</strong>: POST</li>
        <li><strong>URL</strong>: <code>/api/controllers/auth/authcontroller/send_email_recover_password</code></li>
      </ul>
      <h3>Parâmetros</h3>
      <ul>
        <li><code>email</code> (obrigatório, body): Email do usuário.</li>
        <li><code>path</code> (obrigatório, body): URL base para o link de recuperação.</li>
      </ul>
      <h3>Exemplo de Requisição</h3>
      <pre><code>
POST /api/controllers/auth/authcontroller/send_email_recover_password
Content-Type: application/json

{
  "email": "user@example.com",
  "path": "http://frontend.com/reset-password"
}
      </code></pre>
      <h3>Resposta</h3>
      <p><strong>Status</strong>: 200</p>
      <pre><code>
{
  "success": true,
  "message": null,
  "data": null,
  "exception": null
}
      </code></pre>
      <p><strong>Status</strong>: 517 (erro)</p>
      <pre><code>
{
  "success": false,
  "message": "email not found",
  "data": null,
  "exception": null
}
      </code></pre>
      <a href="#top" class="button">Voltar ao topo</a>
    </section>

    <section id="authcontroller-password_change">
      <h2>password_change (RequestHandler)</h2>
      <p>
        Altera a senha do usuário usando o token de recuperação.
      </p>
      <h3>Detalhes do Endpoint</h3>
      <ul>
        <li><strong>Método</strong>: POST</li>
        <li><strong>URL</strong>: <code>/api/controllers/auth/authcontroller/password_change</code></li>
      </ul>
      <h3>Parâmetros</h3>
      <ul>
        <li><code>token</code> (obrigatório, body): Token de recuperação.</li>
        <li><code>password</code> (obrigatório, body): Nova senha (mínimo 8 caracteres).</li>
      </ul>
      <h3>Exemplo de Requisição</h3>
      <pre><code>
POST /api/controllers/auth/authcontroller/password_change
Content-Type: application/json

{
  "token": "recover_token",
  "password": "nova_senha123"
}
      </code></pre>
      <h3>Resposta</h3>
      <p><strong>Status</strong>: 200</p>
      <pre><code>
{
  "success": true,
  "message": null,
  "data": null,
  "exception": null
}
      </code></pre>
      <p><strong>Status</strong>: 401 (erro)</p>
      <pre><code>
{
  "success": false,
  "message": "user not found",
  "data": null,
  "exception": null
}
      </code></pre>
      <a href="#top" class="button">Voltar ao topo</a>
    </section>

    <section id="authcontroller-check_token">
      <h2>check_token</h2>
      <p>
        Middleware que verifica a validade do token JWT em rotas protegidas. Anexa o usuário autenticado ao <code>req.user</code>.
      </p>
      <h3>Detalhes</h3>
      <ul>
        <li><strong>Tipo</strong>: Middleware</li>
        <li><strong>Header</strong>: <code>x-access-token</code> com o token JWT.</li>
        <li><strong>Rotas Não Seguras</strong>: Ignora verificação para <code>/api/online</code>, <code>/api/endpoints</code>, endpoints de autenticação, e <code>/api/controllers/modules/registers/midiascontroller/upload_file</code>.</li>
      </ul>
      <h3>Exemplo de Uso</h3>
      <pre><code>
GET /api/protected-route
x-access-token: jwt_token
      </code></pre>
      <h3>Resposta (Erro)</h3>
      <p><strong>Status</strong>: 401</p>
      <pre><code>
{
  "success": false,
  "message": "token not provided",
  "data": null,
  "exception": null
}
      </code></pre>
      <a href="#top" class="button">Voltar ao topo</a>
    </section>

    <section id="authcontroller-basic_auth">
      <h2>basic_auth</h2>
      <p>
        Middleware que suporta autenticação básica (usuário/senha codificados em Base64 no header <code>Authorization</code>).
      </p>
      <h3>Detalhes</h3>
      <ul>
        <li><strong>Tipo</strong>: Middleware</li>
        <li><strong>Header</strong>: <code>Authorization: Basic &lt;base64(email:senha)&gt;</code></li>
      </ul>
      <h3>Exemplo de Uso</h3>
      <pre><code>
GET /api/protected-route
Authorization: Basic dXNlckBleGFtcGxlLmNvbTpzZW5oYTEyMw==
      </code></pre>
      <h3>Resposta (Erro)</h3>
      <p><strong>Status</strong>: 401</p>
      <pre><code>
{
  "success": false,
  "message": "user not found",
  "data": null,
  "exception": null
}
      </code></pre>
      <a href="#top" class="button">Voltar ao topo</a>
    </section>
  </main>
</body>
</html>