<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Documentação da API OIIS</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    body {
      display: flex;
      min-height: 100vh;
      background-color: #f4f4f4;
    }

    /* Sidebar (Árvore de Navegação) */
    .sidebar {
      width: 250px;
      background-color: #2c3e50;
      color: #ecf0f1;
      padding: 20px;
      position: fixed;
      height: 100%;
      overflow-y: auto;
    }

    .sidebar h2 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: #ecf0f1;
    }

    .sidebar ul {
      list-style: none;
    }

    .sidebar li {
      margin: 10px 0;
    }

    .sidebar a {
      color: #3498db;
      text-decoration: none;
      font-size: 1rem;
      display: block;
      padding: 8px;
      border-radius: 4px;
    }

    .sidebar a:hover, .sidebar a.active {
      background-color: #34495e;
      color: #ecf0f1;
    }

    .sidebar ul ul {
      margin-left: 20px;
    }

    .sidebar ul ul a:before {
      content: '➤ ';
      color: #7f8c8d;
    }

    /* Conteúdo Principal */
    .content {
      margin-left: 270px;
      padding: 20px;
      flex: 1;
      background-color: #fff;
    }

    h1 {
      font-size: 2.5rem;
      color: #2c3e50;
      margin-bottom: 20px;
    }

    h2 {
      font-size: 1.8rem;
      color: #34495e;
      margin: 30px 0 15px;
    }

    h3 {
      font-size: 1.4rem;
      color: #34495e;
      margin: 20px 0 10px;
    }

    p {
      font-size: 1rem;
      line-height: 1.6;
      color: #7f8c8d;
      margin-bottom: 15px;
    }

    a {
      color: #3498db;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    ul, ol {
      margin: 15px 0;
      padding-left: 20px;
    }

    li {
      font-size: 1rem;
      color: #7f8c8d;
      margin-bottom: 10px;
    }

    code {
      background-color: #f5f5f5;
      padding: 2px 4px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
    }

    pre {
      background-color: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }

    .button {
      display: inline-block;
      padding: 10px 20px;
      background-color: #3498db;
      color: #fff;
      border-radius: 4px;
      text-decoration: none;
      margin-top: 20px;
    }

    .button:hover {
      background-color: #2980b9;
    }

    /* Media Queries */
    @media (max-width: 1199px) {
      .sidebar {
        width: 200px;
      }

      .content {
        margin-left: 220px;
      }

      h1 {
        font-size: 2rem;
      }

      h2 {
        font-size: 1.5rem;
      }
    }

    @media (max-width: 767px) {
      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        display: none;
      }

      .sidebar.active {
        display: block;
      }

      .content {
        margin-left: 0;
      }

      .toggle-sidebar {
        display: block;
        padding: 10px;
        background-color: #2c3e50;
        color: #fff;
        text-align: center;
        cursor: pointer;
      }

      .toggle-sidebar:hover {
        background-color: #34495e;
      }
    }
  </style>
</head>
<body>
  <!-- Botão para abrir/fechar sidebar em mobile -->
  <div class="toggle-sidebar" onclick="document.querySelector('.sidebar').classList.toggle('active')">
    Menu de Navegação
  </div>

  <!-- Sidebar com Árvore de Navegação -->
  <nav class="sidebar">
    <h2>Documentação da API</h2>
    <ul>
      <li><a href="#introducao" class="content-link" data-content="main-content">Introdução</a></li>
      <li>
        <a href="authcontroller.html" class="content-link" data-content="authcontroller.html">Autenticação</a>
        <ul>
          <li><a href="authcontroller.html#authcontroller-login" class="content-link" data-content="authcontroller.html#authcontroller-login">login</a></li>
          <li><a href="authcontroller.html#authcontroller-register" class="content-link" data-content="authcontroller.html#authcontroller-register">register</a></li>
          <li><a href="authcontroller.html#authcontroller-refresh_token" class="content-link" data-content="authcontroller.html#authcontroller-refresh_token">refresh_token</a></li>
          <li><a href="authcontroller.html#authcontroller-send_email_recover_password" class="content-link" data-content="authcontroller.html#authcontroller-send_email_recover_password">send_email_recover_password</a></li>
          <li><a href="authcontroller.html#authcontroller-password_change" class="content-link" data-content="authcontroller.html#authcontroller-password_change">password_change</a></li>
          <li><a href="authcontroller.html#authcontroller-check_token" class="content-link" data-content="authcontroller.html#authcontroller-check_token">check_token</a></li>
          <li><a href="authcontroller.html#authcontroller-basic_auth" class="content-link" data-content="authcontroller.html#authcontroller-basic_auth">basic_auth</a></li>
        </ul>
      </li>
      <li>
        <a href="midiascontroller.html" class="content-link" data-content="midiascontroller.html">Mídias</a>
        <ul>
          <li><a href="midiascontroller.html#midiascontroller-upload_file" class="content-link" data-content="midiascontroller.html#midiascontroller-upload_file">upload_file</a></li>
        </ul>
      </li>
      <li>
        <a href="endpointscontroller.html" class="content-link" data-content="endpointscontroller.html">Endpoints</a>
        <ul>
          <li><a href="endpointscontroller.html#endpointscontroller-customize_response" class="content-link" data-content="endpointscontroller.html#endpointscontroller-customize_response">customize_response</a></li>
          <li><a href="endpointscontroller.html#endpointscontroller-autoLoadEndPoints" class="content-link" data-content="endpointscontroller.html#endpointscontroller-autoLoadEndPoints">autoLoadEndPoints</a></li>
          <li><a href="endpointscontroller.html#endpointscontroller-get_endpoints" class="content-link" data-content="endpointscontroller.html#endpointscontroller-get_endpoints">get_endpoints</a></li>
          <li><a href="endpointscontroller.html#endpointscontroller-loadDefaultEndPoints" class="content-link" data-content="endpointscontroller.html#endpointscontroller-loadDefaultEndPoints">loadDefaultEndPoints</a></li>
        </ul>
      </li>
      <li>
        <a href="modelscontroller.html" class="content-link" data-content="modelscontroller.html">Modelos de Dados</a>
        <ul>
          <li><a href="modelscontroller.html#modelscontroller-initModels" class="content-link" data-content="modelscontroller.html#modelscontroller-initModels">initModels</a></li>
          <li><a href="modelscontroller.html#modelscontroller-initAssociations" class="content-link" data-content="modelscontroller.html#modelscontroller-initAssociations">initAssociations</a></li>
        </ul>
      </li>
      <li><a href="#erros" class="content-link" data-content="main-content">Erros</a></li>
    </ul>
  </nav>

  <!-- Conteúdo Principal -->
  <main class="content" id="content">
    <div id="main-content">
      <h1>Documentação da API OIIS</h1>

      <section id="introducao">
        <h2>Introdução</h2>
        <p>
          O <strong>OIIS - Owner Informatic Information System</strong> (nome do pacote: <code>com.oiis.server</code>, versão 3.0.0) é uma API RESTful desenvolvida para gerenciar informações empresariais de forma integrada, com suporte a autenticação segura, upload de arquivos, agendamento de tarefas, envio de emails, integração com mapas e transferência de arquivos via FTP. Construída com <strong>Node.js</strong>, <strong>Express</strong> e <strong>TypeScript</strong>, a API é altamente modular e escalável, com suporte a múltiplos bancos de dados e integrações externas.
        </p>
        <p>
          <strong>Base URL</strong>: <code>http://jumbo.brctec.com:3004</code><br>
          <strong>Repositório</strong>: <a href="https://github.com/aalencarvz1/oiis-server" target="_blank">github.com/aalencarvz1/oiis-server</a><br>
          <strong>Ponto de Entrada</strong>: <code>src/api/api.ts</code> (compilado para <code>dist/api/api.js</code>)
        </p>
        <h3>Tecnologias Utilizadas</h3>
        <ul>
          <li><strong>Node.js</strong>: Ambiente de execução (v18 ou superior).</li>
          <li><strong>Express</strong>: Framework web (v5.1.0).</li>
          <li><strong>TypeScript</strong>: Desenvolvimento tipado (v5.7.2).</li>
          <li><strong>MySQL e OracleDB</strong>: Bancos relacionais, gerenciados via Sequelize (v6.37.5).</li>
          <li><strong>JWT</strong>: Autenticação baseada em tokens (jsonwebtoken v9.0.2).</li>
          <li><strong>Bcrypt</strong>: Hashing de senhas (v5.1.1).</li>
          <li><strong>Multer</strong>: Upload de arquivos (v1.4.5).</li>
          <li><strong>Nodemailer</strong>: Envio de emails (v6.9.16).</li>
          <li><strong>Google Maps</strong>: Integração com APIs de mapas (v3.4.0).</li>
          <li><strong>Toad Scheduler</strong>: Agendamento de tarefas (v3.0.1).</li>
          <li><strong>Basic FTP</strong>: Transferência de arquivos (v5.0.5).</li>
          <li><strong>CORS</strong>: Suporte a requisições cross-origin (v2.8.5).</li>
          <li><strong>Compression</strong>: Compressão de respostas HTTP (v1.7.5).</li>
        </ul>
        <h3>Integrações</h3>
        <p>
          A API suporta integração com sistemas externos:
        </p>
        <ul>
          <li><strong>Winthor</strong>: Gerenciamento de produtos, clientes e filiais.</li>
          <li><strong>SJD</strong>: Dados de estoque, produtos e tabelas de preços.</li>
          <li><strong>EP</strong>: Clientes, vendas e movimentações.</li>
          <li><strong>RFB (Receita Federal)</strong>: Dados de empresas e estabelecimentos.</li>
        </ul>
        <h3>Configuração da API</h3>
        <p>
          A API é configurada com middlewares para otimizar desempenho, segurança e funcionalidade:
        </p>
        <ul>
          <li><strong>CORS</strong>: Permite requisições de origens diferentes.</li>
          <li><strong>Compression</strong>: Reduz o tamanho das respostas HTTP.</li>
          <li><strong>Body Parsing</strong>: Suporta JSON e URL-encoded com limite de 50MB.</li>
          <li><strong>Cookie Parser</strong>: Manipula cookies para autenticação (e.g., refresh tokens).</li>
          <li><strong>JWT Authentication</strong>: Verifica tokens em rotas protegidas, anexando <code>req.user</code>.</li>
          <li><strong>Custom Response</strong>: Respostas padronizadas no formato <code>{ success, message, data, exception }</code>.</li>
        </ul>
        <p>
          Arquivos estáticos são servidos em:
        </p>
        <ul>
          <li><code>/Uploads</code>: Arquivos enviados via endpoint de upload.</li>
          <li><code>/files</code>: Arquivos adicionais armazenados no servidor.</li>
        </p>
        <h3>Formato de Resposta</h3>
        <p>
          Todas as respostas seguem o formato:
        </p>
        <ul>
          <li><code>success</code>: Booleano indicando sucesso ou falha.</li>
          <li><code>message</code>: Mensagem descritiva (ou <code>null</code>).</li>
          <li><code>data</code>: Dados retornados (ou <code>null</code>).</li>
          <li><code>exception</code>: Detalhes de erro, se aplicável (ou <code>null</code>).</li>
        </ul>
        <p>
          Exemplo de sucesso (200):
        </p>
        <pre><code>
{
  "success": true,
  "message": "Operation successful",
  "data": {},
  "exception": null
}
        </code></pre>
        <p>
          Exemplo de erro (517):
        </p>
        <pre><code>
{
  "success": false,
  "message": "Internal server error",
  "data": null,
  "exception": "Error details"
}
        </code></pre>
        <h3>Endpoints</h3>
        <p>
          Endpoints são carregados dinamicamente de <code>src/controllers/</code> com prefixo <code>/api/controllers/</code>. Consulte as seções de controladores na navegação para detalhes.
        </p>
        <h3>Estrutura do Projeto</h3>
        <ul>
          <li><code>src/api/api.ts</code>: Ponto de entrada.</li>
          <li><code>src/api/api_schedulers.ts</code>: Tarefas agendadas.</li>
          <li><code>src/api/config.ts</code>: Configurações.</li>
          <li><code>src/controllers/</code>: Controladores (e.g., <code>AuthController</code>, <code>MidiasController</code>).</li>
          <li><code>src/database/</code>: Modelos Sequelize.</li>
          <li><code>src/utils/</code>: Utilitários (e.g., <code>Utils.ts</code>).</li>
          <li><code>src/types/</code>: Tipagem TypeScript.</li>
        </ul>
        <h3>Configuração e Execução</h3>
        <ol>
          <li>Clone o repositório: <code>git clone https://github.com/aalencarvz1/oiis-server.git</code></li>
          <li>Instale dependências: <code>npm install</code></li>
          <li>Configure <code>.env</code> com:
            <ul>
              <li><code>API_PORT=3004</code></li>
              <li><code>DB_*</code> (credenciais MySQL/OracleDB)</li>
              <li><code>API_SECRET</code>, <code>API_REFRESH_SECRET</code>, <code>API_RECOVER_SECRET</code></li>
              <li><code>API_EMAIL</code>, <code>API_EMAIL_PASSWORD</code></li>
            </ul>
          </li>
          <li>Crie pastas <code>Uploads/</code> e <code>files/</code>.</li>
          <li>Compile TypeScript: <code>npm run build</code></li>
          <li>Inicie a API: <code>npm start</code> ou <code>npm run dev</code></li>
          <li>Inicie agendadores (opcional): <code>npm run start:schedulers</code></li>
        </ol>
        <p>
          A API estará disponível em <code>http://jumbo.brctec.com:3004</code>.
        </p>
        <a href="#top" class="button">Voltar ao topo</a>
      </section>

      <section id="erros">
        <h2>Erros</h2>
        <p>
          A API retorna erros no formato padrão <code>{ success, message, data, exception }</code>. Códigos de status comuns incluem:
        </p>
        <ul>
          <li><strong>200</strong>: Sucesso.</li>
          <li><strong>401</strong>: Falha de autenticação (e.g., token inválido, usuário não encontrado).</li>
          <li><strong>517</strong>: Erro genérico do servidor.</li>
        </ul>
        <p>
          Exemplo de erro:
        </p>
        <pre><code>
{
  "success": false,
  "message": "Internal server error",
  "data": null,
  "exception": "Error details"
}
        </code></pre>
        <a href="#top" class="button">Voltar ao topo</a>
      </section>
    </div>
  </main>

  <script>
    // Toggle da sidebar em mobile
    document.querySelector('.toggle-sidebar').addEventListener('click', () => {
      document.querySelector('.sidebar').classList.toggle('active');
    });

    // Carregamento dinâmico de conteúdo
    const contentDiv = document.getElementById('content');
    const links = document.querySelectorAll('.content-link');

    links.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const contentUrl = link.getAttribute('data-content');
        const href = link.getAttribute('href');

        // Remove classe 'active' de todos os links
        links.forEach(l => l.classList.remove('active'));
        link.classList.add('active');

        if (contentUrl === 'main-content') {
          // Mostra o conteúdo padrão (introdução e erros)
          contentDiv.innerHTML = document.getElementById('main-content').innerHTML;
          if (href.includes('#')) {
            const anchor = href.split('#')[1];
            const element = document.getElementById(anchor);
            if (element) element.scrollIntoView({ behavior: 'smooth' });
          }
        } else {
          // Carrega conteúdo externo via fetch
          fetch(contentUrl)
            .then(response => response.text())
            .then(data => {
              // Extrai apenas o conteúdo dentro de <main>
              const parser = new DOMParser();
              const doc = parser.parseFromString(data, 'text/html');
              const mainContent = doc.querySelector('main').innerHTML;
              contentDiv.innerHTML = mainContent;
              // Rola até a âncora, se especificada
              if (contentUrl.includes('#')) {
                const anchor = contentUrl.split('#')[1];
                const element = document.getElementById(anchor);
                if (element) element.scrollIntoView({ behavior: 'smooth' });
              }
            })
            .catch(error => {
              contentDiv.innerHTML = `<h2>Erro</h2><p>Não foi possível carregar o conteúdo: ${error.message}</p>`;
            });
        }
      });
    });
  </script>
</body>
</html>